{"id":531,"date":"2023-08-06T07:18:59","date_gmt":"2023-08-06T07:18:59","guid":{"rendered":"http:\/\/192.168.0.142\/?p=531"},"modified":"2023-08-10T06:49:14","modified_gmt":"2023-08-10T06:49:14","slug":"composing-a-customized-fedora-image-using-image-builder","status":"publish","type":"post","link":"http:\/\/192.168.0.142\/composing-a-customized-fedora-image-using-image-builder\/","title":{"rendered":"Composing a customized Fedora image using Image Builder"},"content":{"rendered":"\n<p>Image Builder is a tool that allows you to create custom Fedora OS images. You can use the command line or a Cockpit plugin to work with Image Builder.<\/p>\n\n\n\n<h3 class=\"wp-block-heading\">Prerequisites<\/h3>\n\n\n\n<ul>\n<li>Fedora Workstation 38. Refer <a href=\"http:\/\/192.168.0.142\/fedora-workstation-38-installation\/\" data-type=\"link\" data-id=\"http:\/\/192.168.0.142\/fedora-workstation-38-installation\/\">Fedora Workstation 38 Installation<\/a> for installation of Fedora Workstation 38.<\/li>\n\n\n\n<li>Cockpit installed and configured. Refer <a href=\"http:\/\/192.168.0.142\/cockpit-installation-on-fedora-38\/\" data-type=\"link\" data-id=\"http:\/\/192.168.0.142\/cockpit-installation-on-fedora-38\/\">Cockpit installation on Fedora Workstation 38<\/a>.<\/li>\n<\/ul>\n\n\n\n<h3 class=\"wp-block-heading\">Image Builder Installation<\/h3>\n\n\n\n<p><strong>Install Image Builder using below command<\/strong><\/p>\n\n\n\n<pre class=\"wp-block-code\"><code lang=\"bash\" class=\"language-bash\">sudo dnf install -y osbuild-composer composer-cli cockpit-composer<\/code><\/pre>\n\n\n\n<p><strong>Enable osbuild-composer.socket<\/strong><\/p>\n\n\n\n<pre class=\"wp-block-code\"><code lang=\"bash\" class=\"language-bash\">sudo systemctl enable --now osbuild-composer.socket<\/code><\/pre>\n\n\n\n<p>To run the composer-cli commands as non-root, user must be in the weldr or root groups.<\/p>\n\n\n\n<p>The newgrp command changes a user&#8217;s real group identification. When you run the command, the system places you in a new shell and changes the name of your real group to the group specified with the Group parameter<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code lang=\"bash\" class=\"language-bash\">sudo usermod -a -G weldr $USER\nnewgrp weldr<\/code><\/pre>\n\n\n\n<h3 class=\"wp-block-heading\">Image Blueprint<\/h3>\n\n\n\n<p>The first step in using Image Builder is to create the blueprint of the image. The blueprint includes everything the image needs to run. Blueprint files are .toml files<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code lang=\"bash\" class=\"language-bash\"> mkdir blueprints &amp;&amp; cd blueprints<\/code><\/pre>\n\n\n\n<p><strong>Create file hyrule-os.toml and add below contents<\/strong><\/p>\n\n\n\n<pre class=\"wp-block-code\"><code lang=\"toml\" class=\"language-toml\">name = \"hyrule-os\"\ndescription = \"\"\nversion = \"1.0.0\"\nmodules = []\ngroups = []\ndistro = \"\"\n\n[[packages]]\nname = \"ansible-core\"\nversion = \"*\"\n\n[[packages]]\nname = \"podman\"\nversion = \"*\"\n\n[[packages]]\nname = \"skopeo\"\nversion = \"*\"\n\n[customizations]\n\n[[customizations.user]]\nname = \"link\"\npassword = \"$6$st3tG34hIMT10Zrb$WzU\/4OSYY6IqASjpnA0wGNIzemI13pYYqDleQPjLgILE1Gi2HS71fETX2wVkiOg8S.uFnRC9.tYkjCOd8O0a2.\"\ngroups = [\"wheel\"]<\/code><\/pre>\n\n\n\n<p><strong>Password hash generation<\/strong><\/p>\n\n\n\n<pre class=\"wp-block-code\"><code lang=\"bash\" class=\"language-bash\">python3 -c 'import crypt,getpass;pw=getpass.getpass();print(crypt.crypt(pw) if (pw==getpass.getpass(\"Confirm: \")) else exit())'<\/code><\/pre>\n\n\n\n<p><strong>Push blueprint<\/strong><\/p>\n\n\n\n<pre class=\"wp-block-code\"><code lang=\"bash\" class=\"language-bash\">composer-cli blueprints push hyrule-os.toml<\/code><\/pre>\n\n\n\n<p><strong>Resolve dependencies in the blueprint<\/strong><\/p>\n\n\n\n<pre class=\"wp-block-code\"><code lang=\"bash\" class=\"language-bash\">composer-cli blueprints depsolve hyrule-os<\/code><\/pre>\n\n\n\n<p><strong>List blueprints<\/strong><\/p>\n\n\n\n<pre class=\"wp-block-code\"><code lang=\"bash\" class=\"language-bash\">composer-cli blueprints list<\/code><\/pre>\n\n\n\n<p><strong>Terminal output for reference<\/strong><\/p>\n\n\n\n<pre class=\"wp-block-code\"><code lang=\"bash\" class=\"language-bash\">$ composer-cli blueprints list\nhyrule-os<\/code><\/pre>\n\n\n\n<p><strong>List the available image types<\/strong><\/p>\n\n\n\n<pre class=\"wp-block-code\"><code lang=\"bash\" class=\"language-bash\">composer-cli compose types<\/code><\/pre>\n\n\n\n<p><em>Terminal output for reference<\/em><\/p>\n\n\n\n<pre class=\"wp-block-code\"><code lang=\"bash\" class=\"language-bash\">$ composer-cli compose types\nami\ncontainer\nimage-installer\niot-commit\niot-container\niot-installer\niot-raw-image\nlive-installer\nminimal-raw\noci\nopenstack\nova\nqcow2\nvhd\nvmdk\nwsl<\/code><\/pre>\n\n\n\n<p><strong>Start a compose. It may take several minutes to finish the compose process<\/strong><\/p>\n\n\n\n<pre class=\"wp-block-code\"><code lang=\"bash\" class=\"language-bash\">composer-cli compose start BLUEPRINT COMPOSE-TYPE<\/code><\/pre>\n\n\n\n<pre class=\"wp-block-code\"><code lang=\"bash\" class=\"language-bash\">$ composer-cli compose start hyrule-os qcow2\nCompose 00d2ec3d-4086-45b6-838c-bd1b8f86f797 added to the queue<\/code><\/pre>\n\n\n\n<p><strong>List all composes and their status<\/strong><\/p>\n\n\n\n<pre class=\"wp-block-code\"><code lang=\"bash\" class=\"language-bash\">composer-cli compose status<\/code><\/pre>\n\n\n\n<p><em>Terminal output for reference<\/em><\/p>\n\n\n\n<pre class=\"wp-block-code\"><code lang=\"bash\" class=\"language-bash\">$ composer-cli compose status\nID                                     Status     Time                      Blueprint         Version   Type               Size\naa3d9568-4eba-43fc-b653-3c77b6be8e0a   FINISHED   Wed Aug 9 18:15:59 2023   hyrule-os         1.0.0     qcow2              5368709120<\/code><\/pre>\n\n\n\n<p><strong>Create the image using below command<\/strong><\/p>\n\n\n\n<pre class=\"wp-block-code\"><code lang=\"bash\" class=\"language-bash\">composer-cli compose image UUID<\/code><\/pre>\n\n\n\n<p><em>Terminal output for reference<\/em><\/p>\n\n\n\n<pre class=\"wp-block-code\"><code lang=\"bash\" class=\"language-bash\">$ composer-cli compose image aa3d9568-4eba-43fc-b653-3c77b6be8e0a \naa3d9568-4eba-43fc-b653-3c77b6be8e0a-disk.qcow2<\/code><\/pre>\n\n\n\n<p><strong>Test the image by running below command<\/strong><\/p>\n\n\n\n<pre class=\"wp-block-code\"><code class=\"\">sudo qemu-kvm --name hyrule-os -m 1024 -hda aa3d9568-4eba-43fc-b653-3c77b6be8e0a-disk.qcow2 <\/code><\/pre>\n\n\n\n<p><\/p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"990\" height=\"739\" src=\"http:\/\/192.168.0.142\/wp-content\/uploads\/2023\/08\/fedora-workstation-38-qemu-kvm.png\" alt=\"Fedora Workstation qemu kvm\" class=\"wp-image-789\" srcset=\"http:\/\/192.168.0.142\/wp-content\/uploads\/2023\/08\/fedora-workstation-38-qemu-kvm.png 990w, http:\/\/192.168.0.142\/wp-content\/uploads\/2023\/08\/fedora-workstation-38-qemu-kvm-300x224.png 300w, http:\/\/192.168.0.142\/wp-content\/uploads\/2023\/08\/fedora-workstation-38-qemu-kvm-768x573.png 768w\" sizes=\"(max-width: 990px) 100vw, 990px\" \/><\/figure>\n","protected":false},"excerpt":{"rendered":"<p>Image Builder is a tool that allows you to create custom Fedora OS images. You can use the command line or a Cockpit plugin to work with Image Builder. Prerequisites Image Builder Installation Install Image Builder using below command Enable osbuild-composer.socket To run the composer-cli commands as non-root, user must be in the weldr or &#8230; <a title=\"Composing a customized Fedora image using Image Builder\" class=\"read-more\" href=\"http:\/\/192.168.0.142\/composing-a-customized-fedora-image-using-image-builder\/\" aria-label=\"More on Composing a customized Fedora image using Image Builder\">Read more<\/a><\/p>\n","protected":false},"author":1,"featured_media":786,"comment_status":"closed","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[46],"tags":[47,65,66],"_links":{"self":[{"href":"http:\/\/192.168.0.142\/wp-json\/wp\/v2\/posts\/531"}],"collection":[{"href":"http:\/\/192.168.0.142\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/192.168.0.142\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/192.168.0.142\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"http:\/\/192.168.0.142\/wp-json\/wp\/v2\/comments?post=531"}],"version-history":[{"count":30,"href":"http:\/\/192.168.0.142\/wp-json\/wp\/v2\/posts\/531\/revisions"}],"predecessor-version":[{"id":792,"href":"http:\/\/192.168.0.142\/wp-json\/wp\/v2\/posts\/531\/revisions\/792"}],"wp:featuredmedia":[{"embeddable":true,"href":"http:\/\/192.168.0.142\/wp-json\/wp\/v2\/media\/786"}],"wp:attachment":[{"href":"http:\/\/192.168.0.142\/wp-json\/wp\/v2\/media?parent=531"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/192.168.0.142\/wp-json\/wp\/v2\/categories?post=531"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/192.168.0.142\/wp-json\/wp\/v2\/tags?post=531"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}