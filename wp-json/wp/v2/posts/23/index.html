{"id":23,"date":"2023-07-30T12:16:48","date_gmt":"2023-07-30T12:16:48","guid":{"rendered":"http:\/\/192.168.0.149:30000\/?p=23"},"modified":"2023-07-30T12:39:11","modified_gmt":"2023-07-30T12:39:11","slug":"installation-of-microshift-4-13-on-rhel-9-2","status":"publish","type":"post","link":"http:\/\/192.168.0.149:30000\/2023\/07\/30\/installation-of-microshift-4-13-on-rhel-9-2\/","title":{"rendered":"Installation of Microshift 4.13 on RHEL 9.2"},"content":{"rendered":"\n<p>[[<em>TOC<\/em>]]<\/p>\n\n\n\n<h1 class=\"wp-block-heading\">1. Introduction<\/h1>\n\n\n\n<p>This document explains the steps to install Microshift 4.13 on RHEL 9.2<\/p>\n\n\n\n<h2 class=\"wp-block-heading\">1.1 Reference<\/h2>\n\n\n\n<figure class=\"wp-block-embed\"><div class=\"wp-block-embed__wrapper\">\nhttps:\/\/access.redhat.com\/documentation\/en-us\/red_hat_build_of_microshift\/4.13\/html\/installing\/microshift-install-rpm\n<\/div><\/figure>\n\n\n\n<h1 class=\"wp-block-heading\">2. Prerequisites<\/h1>\n\n\n\n<ul>\n<li>Add an extra hard disk for data persistence.<\/li>\n<\/ul>\n\n\n\n<h1 class=\"wp-block-heading\">3. Install RHEL 9.2 in target machine<\/h1>\n\n\n\n<ul>\n<li>Download &#8216;Red Hat Enterprise Linux 9.2 Binary DVD&#8217; from https:\/\/access.redhat.com\/downloads\/content\/rhel and install in the target machine.<\/li>\n<\/ul>\n\n\n\n<h1 class=\"wp-block-heading\">4. Installation of Microshift<\/h1>\n\n\n\n<ul>\n<li>Create &#8216;edgenius&#8217; volume group as described in <\/li>\n\n\n\n<li>Register the system using subscription-manager<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>sudo subscription-manager register<\/code><\/pre>\n\n\n\n<ul>\n<li>Enable the Red Hat build of MicroShift repositories by running the following command<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>sudo subscription-manager repos \\\n    --enable rhocp-4.13-for-rhel-9-$(uname -m)-rpms \\\n    --enable fast-datapath-for-rhel-9-$(uname -m)-rpms<\/code><\/pre>\n\n\n\n<ul>\n<li>Install Red Hat build of MicroShift and openshift clients by running the following command.<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>sudo dnf install -y microshift openshift-clients<\/code><\/pre>\n\n\n\n<ul>\n<li>Configure firewall rules<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>sudo firewall-cmd --permanent --zone=trusted --add-source=10.42.0.0\/16\nsudo firewall-cmd --permanent --zone=trusted --add-source=169.254.169.1\nsudo firewall-cmd --reload<\/code><\/pre>\n\n\n\n<ul>\n<li>Download pull secret for Redhat registries. Refer <a href=\"https:\/\/dev.azure.com\/ABB-BCI-PCP\/PCP\/_wiki\/wikis\/Digital%20Stream\/39246\/Installation-of-Microshift-4.13-on-RHEL-9.2?_a=edit&amp;anchor=5.2-download-pull-secret-for-redhat-registries\">5.2 Download pull secret for Redhat registries<\/a><\/li>\n\n\n\n<li>Upload file to target machine and rename file to pull-secret.json.<\/li>\n\n\n\n<li>copy the pull secret to the \/etc\/crio folder.<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>sudo cp pull-secret.json \/etc\/crio\/openshift-pull-secret<\/code><\/pre>\n\n\n\n<ul>\n<li>Make the root user the owner of the \/etc\/crio\/openshift-pull-secret file by running the following command.<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>sudo chown root:root \/etc\/crio\/openshift-pull-secret<\/code><\/pre>\n\n\n\n<ul>\n<li>Make the \/etc\/crio\/openshift-pull-secret file readable and writeable by the root user only by running the following command.<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>sudo chmod 600 \/etc\/crio\/openshift-pull-secret<\/code><\/pre>\n\n\n\n<ul>\n<li>Creating an LVMS configuration file. When Red Hat build of MicroShift runs, it uses LVMS configuration from \/etc\/microshift\/lvmd.yaml. Make sure that volume-group &#8216;edgenius&#8217; is created.<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>sudo cp \/etc\/microshift\/lvmd.yaml.default \/etc\/microshift\/lvmd.yaml<\/code><\/pre>\n\n\n\n<ul>\n<li>Edit \/etc\/microshift\/lvmd.yaml.<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code># Unix domain socket endpoint of gRPC\nsocket-name: \/run\/lvmd\/lvmd.socket\n\ndevice-classes:\n  # The name of a device-class\n  - name: default\n\n    # The group where this device-class creates the logical volumes\n    volume-group: edgenius\n\n    # Storage capacity in GiB to be spared\n    spare-gb: 0\n\n    # A flag to indicate that this device-class is used by default\n    default: true\n\n    # The number of stripes in the logical volume\n    #stripe: \"\"\n\n    # The amount of data that is written to one device before moving to the next device\n    #stripe-size: \"\"\n\n    # Extra arguments to pass to lvcreate, e.g. &#91;\"--type=raid1\"]\n    #lvcreate-options:\n      #- \"\"<\/code><\/pre>\n\n\n\n<ul>\n<li>Start the Red Hat build of MicroShift service by entering the following command.<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>sudo systemctl start microshift<\/code><\/pre>\n\n\n\n<ul>\n<li>To start MicroShift when machine starts, enter the following command.<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>sudo systemctl enable microshift<\/code><\/pre>\n\n\n\n<ul>\n<li>Check the service logs by running below command<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>journalctl -u microshift.service -f<\/code><\/pre>\n\n\n\n<ul>\n<li>Create kubeconfig file in home directory<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>mkdir ~\/.kube\nsudo cat \/var\/lib\/microshift\/resources\/kubeadmin\/kubeconfig &gt; ~\/.kube\/config<\/code><\/pre>\n\n\n\n<ul>\n<li>Check the status of pods by running below command. The installation might take several minutes to complete.<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>oc get po -A<\/code><\/pre>\n\n\n\n<pre class=\"wp-block-code\"><code>&#91;ability@localhost ~]$ oc get po -A\nNAMESPACE                  NAME                                 READY   STATUS              RESTARTS   AGE\nopenshift-dns              node-resolver-mcdxd                  0\/1     ContainerCreating   0          2m3s\nopenshift-ingress          router-default-65864549b5-fbrkl      0\/1     Pending             0          2m3s\nopenshift-ovn-kubernetes   ovnkube-master-q729v                 0\/4     ContainerCreating   0          2m3s\nopenshift-ovn-kubernetes   ovnkube-node-spbf4                   0\/1     ContainerCreating   0          2m3s\nopenshift-service-ca       service-ca-764bd7f7b7-c82g5          0\/1     Pending             0          2m4s\nopenshift-storage          topolvm-controller-f58fcd7cb-m9ng4   0\/4     Pending             0          2m3s<\/code><\/pre>\n\n\n\n<ul>\n<li>To test microshift installation refer<\/li>\n<\/ul>\n\n\n\n<h1 class=\"wp-block-heading\">5. Appendinx<\/h1>\n\n\n\n<h2 class=\"wp-block-heading\">5.1 Create edgenius volume group<\/h2>\n\n\n\n<ul>\n<li>Make sure that an extra hard disk is added for data peristence. Check the physical volumes in the machine by running the following command.<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>pvs<\/code><\/pre>\n\n\n\n<pre class=\"wp-block-code\"><code>&#91;root@localhost ability]# pvs\n  PV         VG   Fmt  Attr PSize    PFree\n  \/dev\/sda2  rhel lvm2 a--  &lt;199.00g    0 <\/code><\/pre>\n\n\n\n<ul>\n<li>Create a PV<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>pvcreate \/dev\/sdb<\/code><\/pre>\n\n\n\n<pre class=\"wp-block-code\"><code>&#91;root@localhost ability]# pvcreate \/dev\/sdb\n  Physical volume \"\/dev\/sdb\" successfully created.\n&#91;root@localhost ability]# pvs\n  PV         VG   Fmt  Attr PSize    PFree  \n  \/dev\/sda2  rhel lvm2 a--  &lt;199.00g      0 \n  \/dev\/sdb        lvm2 ---   200.00g 200.00g<\/code><\/pre>\n\n\n\n<ul>\n<li>Create a new volume group<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>vgcreate edgenius \/dev\/sdb <\/code><\/pre>\n\n\n\n<pre class=\"wp-block-code\"><code>&#91;root@localhost ability]# vgcreate edgenius \/dev\/sdb\n  Volume group \"edgenius\" successfully created<\/code><\/pre>\n\n\n\n<ul>\n<li>Check the pvs in the machine.<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>&#91;root@localhost ability]# pvs\n  PV         VG       Fmt  Attr PSize    PFree   \n  \/dev\/sda2  rhel     lvm2 a--  &lt;199.00g       0 \n  \/dev\/sdb   edgenius lvm2 a--  &lt;200.00g &lt;200.00g<\/code><\/pre>\n\n\n\n<h2 class=\"wp-block-heading\">5.2 Download pull secret for Redhat registries<\/h2>\n\n\n\n<figure class=\"wp-block-image size-large\"><img decoding=\"async\" loading=\"lazy\" width=\"1024\" height=\"460\" src=\"http:\/\/192.168.0.149:30000\/wp-content\/uploads\/2023\/07\/Screenshot-2023-07-30-175459-1024x460.png\" alt=\"\" class=\"wp-image-26\" srcset=\"http:\/\/192.168.0.149:30000\/wp-content\/uploads\/2023\/07\/Screenshot-2023-07-30-175459-1024x460.png 1024w, http:\/\/192.168.0.149:30000\/wp-content\/uploads\/2023\/07\/Screenshot-2023-07-30-175459-300x135.png 300w, http:\/\/192.168.0.149:30000\/wp-content\/uploads\/2023\/07\/Screenshot-2023-07-30-175459-768x345.png 768w, http:\/\/192.168.0.149:30000\/wp-content\/uploads\/2023\/07\/Screenshot-2023-07-30-175459-1536x690.png 1536w, http:\/\/192.168.0.149:30000\/wp-content\/uploads\/2023\/07\/Screenshot-2023-07-30-175459.png 1659w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<ul>\n<li>Access https:\/\/console.redhat.com\/openshift\/install\/pull-secret.<\/li>\n\n\n\n<li>Login with Redhat credentials.<\/li>\n\n\n\n<li>Click on &#8216;Download pull secret&#8217; to get the pull-secret.txt file.<\/li>\n<\/ul>\n\n\n\n<h2 class=\"wp-block-heading\">5.3 Test microshift installation<\/h2>\n\n\n\n<ul>\n<li>Create namespace<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>oc create ns test<\/code><\/pre>\n\n\n\n<ul>\n<li>Create test.yaml and copy below contents.<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>kind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: my-lv-pvc\n  namespace: test\nspec:\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: 1G\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: my-pod\n  namespace: test\nspec:\n  containers:\n  - name: nginx\n    image: quay.io\/jitesoft\/nginx\n    command: &#91;\"\/bin\/sleep\", \"1d\"]\n    volumeMounts:\n    - mountPath: \/mnt\n      name: my-volume\n    securityContext:\n      allowPrivilegeEscalation: false\n      capabilities:\n        drop:\n          - ALL\n      runAsNonRoot: true\n      seccompProfile:\n        type: RuntimeDefault\n  volumes:\n    - name: my-volume\n      persistentVolumeClaim:\n        claimName: my-lv-pvc<\/code><\/pre>\n\n\n\n<ul>\n<li>Create pvc and pod<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>oc create -f test.yaml<\/code><\/pre>\n\n\n\n<ul>\n<li>Check the status of pod, pvc and pv.<\/li>\n<\/ul>\n\n\n\n<pre class=\"wp-block-code\"><code>&#91;ability@localhost test]$ oc get po -n test\nNAME     READY   STATUS    RESTARTS   AGE\nmy-pod   1\/1     Running   0          2m7s\n&#91;ability@localhost test]$ oc get pvc -n test\nNAME        STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS          AGE\nmy-lv-pvc   Bound    pvc-1d6e6430-b052-4c4b-8ff2-df3b23dd9160   1Gi        RWO            topolvm-provisioner   2m13s\n&#91;ability@localhost test]$ oc get pv -n test\nNAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM            STORAGECLASS          REASON   AGE\npvc-1d6e6430-b052-4c4b-8ff2-df3b23dd9160   1Gi        RWO            Delete           Bound    test\/my-lv-pvc   topolvm-provisioner            2m19s<\/code><\/pre>\n\n\n\n<h1 class=\"wp-block-heading\">6. Document History<\/h1>\n","protected":false},"excerpt":{"rendered":"<p>[[TOC]] 1. Introduction This document explains the steps to install Microshift 4.13 on RHEL 9.2 1.1 Reference 2. Prerequisites 3. Install RHEL 9.2 in target machine 4. Installation of Microshift 5. Appendinx 5.1 Create edgenius volume group 5.2 Download pull secret for Redhat registries 5.3 Test microshift installation 6. Document History<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"closed","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[1],"tags":[],"_links":{"self":[{"href":"http:\/\/192.168.0.149:30000\/wp-json\/wp\/v2\/posts\/23"}],"collection":[{"href":"http:\/\/192.168.0.149:30000\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/192.168.0.149:30000\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/192.168.0.149:30000\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"http:\/\/192.168.0.149:30000\/wp-json\/wp\/v2\/comments?post=23"}],"version-history":[{"count":4,"href":"http:\/\/192.168.0.149:30000\/wp-json\/wp\/v2\/posts\/23\/revisions"}],"predecessor-version":[{"id":28,"href":"http:\/\/192.168.0.149:30000\/wp-json\/wp\/v2\/posts\/23\/revisions\/28"}],"wp:attachment":[{"href":"http:\/\/192.168.0.149:30000\/wp-json\/wp\/v2\/media?parent=23"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/192.168.0.149:30000\/wp-json\/wp\/v2\/categories?post=23"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/192.168.0.149:30000\/wp-json\/wp\/v2\/tags?post=23"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}